window.__require=function t(e,o,i){function n(a,s){if(!o[a]){if(!e[a]){var c=a.split("/");if(c=c[c.length-1],!e[c]){var l="function"==typeof __require&&__require;if(!s&&l)return l(c,!0);if(r)return r(c,!0);throw new Error("Cannot find module '"+a+"'")}a=c}var u=o[a]={exports:{}};e[a][0].call(u.exports,function(t){return n(e[a][1][t]||t)},u,u.exports,t,e,o,i)}return o[a].exports}for(var r="function"==typeof __require&&__require,a=0;a<i.length;a++)n(i[a]);return n}({Game:[function(t,e){"use strict";function o(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(o)return(o=o.call(t)).next.bind(o);if(Array.isArray(t)||(o=i(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(t,e){if(t){if("string"==typeof t)return n(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?n(t,e):void 0}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,i=new Array(e);o<e;o++)i[o]=t[o];return i}cc._RF.push(e,"52cea1c2YxOG7fVaE2W8T77","Game"),cc.Class({extends:cc.Component,properties:{background:cc.Sprite,mapBackground:cc.Sprite,labelBackground:cc.Prefab,overView:cc.Prefab,manager:{default:null},tiles:[],undoStack:[],tile:cc.Prefab,tileOriginX:0,tileOriginY:0,tileSpace:10,maxNumLabel:cc.Label,describeLabel:cc.Label,score:0,scoreLabel:cc.Label,bestScore:0,bestScoreLabel:cc.Label,undoLabel:cc.Label,undoCount:0,shuffleCount:0,shuffleLabel:cc.Label,currentOverView:{default:null,type:cc.Sprite},animationDuration:.1,currentMousePositionX:-1,currentMousePositionY:-1,isAnimation:!1,isTouchMoved:!1},onLoad:function(){SonarCocosHelper.IOS.Setup(),SonarCocosHelper.AdMob.showBannerAd(SonarCocosHelper.AdBannerPosition.eTop),this.setupTiles();var t=cc.sys.localStorage.getItem("bestScore");t||(t=0),this.updateBestScore(t);var e=cc.sys.localStorage.getItem("shuffleCount");e||(e=5),this.updateShuffleCount(e);var o=cc.sys.localStorage.getItem("undoCount");o||(o=5),this.updateUndoCount(o),this.setupMapBackground(),this.setupEventListener()},setTilePosition:function(t,e,o,i){var n=this.tileOriginX+this.tileSpace+o*(this.tileSpace+this.manager.tileSize.width),r=this.tileOriginY+this.tileSpace+e*(this.tileSpace+this.manager.tileSize.height);if(i){var a=cc.moveTo(this.animationDuration,cc.v2(n,r));t.runAction(a)}else t.setPosition(n,r);t.row=e,t.col=o,t.getComponent("Tile")&&(t.getComponent("Tile").row=e,t.getComponent("Tile").col=o)},setupTiles:function(){this.manager=t("Manager"),3==this.manager.order?(this.tiles=[[null,null,null],[null,null,null],[null,null,null]],this.maxNumLabel.string="1024",this.describeLabel.string="Join the numbers\nto get to 1024"):4==this.manager.order?(this.tiles=[[null,null,null,null],[null,null,null,null],[null,null,null,null],[null,null,null,null]],this.maxNumLabel.string="2048",this.describeLabel.string="Join the numbers\nto get to 2048"):5==this.manager.order&&(this.tiles=[[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null]],this.maxNumLabel.string="8192",this.describeLabel.string="Join the numbers\nto get to 8192")},setupMapBackground:function(){this.background.node.color=this.manager.backgroundColor(),this.mapBackground.node.color=this.manager.scoreBoardColor();var t=cc.instantiate(this.labelBackground);this.manager.tileSize.width=t.width,this.manager.tileSize.height=t.height;var e=this.manager.getRowCount(),o=this.manager.getColCount(),i=(this.manager.tileSize.width+this.tileSpace)*e+this.tileSpace,n=(this.manager.tileSize.height+this.tileSpace)*o+this.tileSpace;this.mapBackground.node.width=i,this.mapBackground.node.height=n,this.tileOriginX=-1*(i-this.manager.tileSize.width)/2,this.tileOriginY=-1*(n-this.manager.tileSize.height)/2;for(var r=0;r<e;r++)for(var a=0;a<o;a++){var s=cc.instantiate(this.labelBackground);this.setTilePosition(s,r,a,!1),this.mapBackground.node.addChild(s)}this.createRandomTile(!1),this.createRandomTile(!1)},testFunc:function(){this.showOverView()},showOverView:function(){null==this.currentOverView&&(this.currentOverView=cc.instantiate(this.overView)),this.background.node.addChild(this.currentOverView),SonarCocosHelper.AdMob.showFullscreenAd()},setupEventListener:function(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),this.mapBackground.node.on(cc.Node.EventType.TOUCH_START,function(t){var e=t.touch.getLocation();this.currentMousePositionX=e.x,this.currentMousePositionY=e.y,this.isTouchMoved=!1},this);var t=function(t){if(!this.isTouchMoved){var e=t.touch.getLocation(),o=e.x-this.currentMousePositionX,i=e.y-this.currentMousePositionY;cc.v2(o,i).mag()<20||(this.isTouchMoved=!0,Math.abs(o)>Math.abs(i)?o>0?this.actionForKeyCode(cc.macro.KEY.right):this.actionForKeyCode(cc.macro.KEY.left):i>0?this.actionForKeyCode(cc.macro.KEY.up):this.actionForKeyCode(cc.macro.KEY.down))}};this.mapBackground.node.on(cc.Node.EventType.TOUCH_MOVE,t,this),this.mapBackground.node.on(cc.Node.EventType.TOUCH_CANCEL,t,this)},onKeyUp:function(t){this.actionForKeyCode(t.keyCode)},actionForKeyCode:function(t){if(!this.isAnimation){var e=!1,o={score:this.score,tiles:[]};o.score=this.score;for(var i=this.manager.getRowCount(),n=this.manager.getColCount(),r=0;r<i;r++)for(var a=0;a<n;a++)if(null!=this.tiles[r][a]){var s=this.tiles[r][a].getComponent("Tile");o.tiles.push(s.save())}switch(t){case cc.macro.KEY.up:e=this.moveUp();break;case cc.macro.KEY.down:e=this.moveDown();break;case cc.macro.KEY.left:e=this.moveLeft();break;case cc.macro.KEY.right:e=this.moveRight()}e?(this.undoStack.push(o),this.isAnimation=!0,this.createRandomTile(!0)||this.showOverView()):this.checkWhetherOver()&&this.showOverView()}},addScore:function(t){this.score+=t,this.scoreLabel.string=this.score.toString(),this.score>this.bestScore&&this.updateBestScore(this.score)},clearScore:function(){this.score=0,this.scoreLabel.string=this.score.toString()},updateBestScore:function(t){this.bestScore=t,this.bestScoreLabel.string=this.bestScore.toString(),cc.sys.localStorage.setItem("bestScore",this.bestScore)},updateUndoCount:function(t){this.undoCount=t,this.undoLabel.string=this.undoCount.toString(),cc.sys.localStorage.setItem("undoCount",this.undoCount)},updateShuffleCount:function(t){this.shuffleCount=t,this.shuffleLabel.string=this.shuffleCount.toString(),cc.sys.localStorage.setItem("shuffleCount",this.shuffleCount)},handleRestart:function(){this.currentOverView&&this.currentOverView.removeFromParent(),this.mapBackground.node.removeAllChildren(),this.undoStack=[],this.setupTiles(),this.setupMapBackground(),this.score=0,this.scoreLabel.string=this.score.toString()},handleUndoPlus:function(){SonarCocosHelper.AdMob.showRewardedAd(function(t){cc.log("onEarnReward: "+t);var e=cc.find("Canvas").getComponent("Game");e.updateUndoCount(e.undoCount+1)})},handleShufflePlus:function(){SonarCocosHelper.AdMob.showRewardedAd(function(t){cc.log("onEarnReward: "+t);var e=cc.find("Canvas").getComponent("Game");e.updateShuffleCount(e.shuffleCount+1)})},handleUndo:function(){if(this.undoCount>0&&this.undoStack.length>0){this.currentOverView&&this.currentOverView.removeFromParent(),this.updateUndoCount(this.undoCount-1);var t=this.undoStack.pop();this.score=t.score,this.scoreLabel.string=this.score.toString();for(var e=this.manager.getRowCount(),i=this.manager.getColCount(),n=0;n<e;n++)for(var r=0;r<i;r++)this.tiles[n][r]&&(this.tiles[n][r].removeFromParent(),this.tiles[n][r]=null);for(var a,s=o(t.tiles);!(a=s()).done;){var c=a.value;this.createTileByUndo(cc.v2(c.row,c.col),c.tag)}}},handleShuffle:function(){if(this.shuffleCount>0){this.currentOverView&&this.currentOverView.removeFromParent(),this.updateShuffleCount(this.shuffleCount-1);for(var t=0;t<this.tiles.length;t++)for(var e=0;e<this.tiles[t].length;e++){var o=Math.floor(Math.random()*this.tiles.length),i=Math.floor(Math.random()*this.tiles[t].length),n=this.tiles[t][e];this.tiles[t][e]=this.tiles[o][i],this.tiles[o][i]=n,this.tiles[t][e]&&this.setTilePosition(this.tiles[t][e],t,e),this.tiles[o][i]&&this.setTilePosition(this.tiles[o][i],o,i)}}},onEarnReward:function(t){cc.log("onEarnReward: "+t),cc.find("Canvas").getComponent("Game").addScore(t)},createRandomTile:function(t){for(var e=this.manager.getRowCount(),o=this.manager.getColCount(),i=[],n=0;n<e;n++)for(var r=0;r<o;r++)null==this.tiles[n][r]&&i.push(cc.v2(n,r));if(0==i.size)return!1;var a=i[Math.floor(Math.random()*i.length)];if(t){var s=cc.delayTime(this.animationDuration+.1),c=cc.callFunc(this.createTileAtPosition,this,a),l=cc.callFunc(this.resetIsAnimation,this),u=cc.sequence([s,c,l]);this.node.runAction(u)}else this.createTileAtPosition(this.node,a),this.resetIsAnimation();return!0},resetIsAnimation:function(){this.isAnimation=!1},checkWhetherOver:function(){for(var t=this.manager.getRowCount(),e=this.manager.getColCount(),o=!0,i=0;i<t;i++)for(var n=0;n<e;n++){if(null==this.tiles[i][n]){o=!1;break}var r=this.tiles[i][n].getComponent("Tile"),a=i+1;if(a<t){if(null==this.tiles[a][n]){o=!1;break}if(this.tiles[a][n].getComponent("Tile").tag==r.tag){o=!1;break}}var s=n+1;if(s<e){if(null==this.tiles[i][s]){o=!1;break}if(this.tiles[i][s].getComponent("Tile").tag==r.tag){o=!1;break}}}return o},createTileAtPosition:function(t,e){var o=cc.instantiate(this.tile);this.tiles[e.x][e.y]=o,this.setTilePosition(o,e.x,e.y),this.mapBackground.node.addChild(o)},createTileByUndo:function(t,e){var o=cc.instantiate(this.tile);this.tiles[t.x][t.y]=o,this.setTilePosition(o,t.x,t.y),this.mapBackground.node.addChild(o),o.getComponent("Tile").setTag(e)},mergeTiles:function(){},moveTilePosition:function(t,e,o,i,n){this.tiles[e][o]=null,this.tiles[i][n]=t,this.setTilePosition(t,i,n,!0)},moveUp:function(){var t=this.manager.getRowCount(),e=this.manager.getColCount();return this.moveVertically(e,t,function(e){return t-1-e})},moveDown:function(){var t=this.manager.getRowCount(),e=this.manager.getColCount();return this.moveVertically(e,t,function(t){return t})},moveLeft:function(){var t=this.manager.getRowCount(),e=this.manager.getColCount();return this.moveHorizontally(t,e,function(t){return t})},moveRight:function(){var t=this.manager.getRowCount(),e=this.manager.getColCount();return this.moveHorizontally(t,e,function(t){return e-1-t})},moveVertically:function(e,o,i){for(var n=!1,r=0;r<e;r++)for(var a=0,s=this.tiles[i(a)][r],c=1;c<o;c++){var l=i(c),u=this.tiles[l][r];if(null!=u)if(null!=s){var h=s.getComponent("Tile"),g=u.getComponent("Tile"),d=i(a+1);if(h.tag!=g.tag)l!=d?(this.moveTilePosition(u,l,r,d,r),a++,n=!0):a=c,s=u;else{var f=t("Manager"),m=Math.pow(f.cardinality,g.tag+1);this.addScore(m),this.moveTilePosition(u,l,r,s.row,s.col),this.tiles[s.row][s.col]=s;var v=cc.delayTime(this.animationDuration),p=cc.callFunc(this.updateTag,this,u),C=cc.sequence([v,p]);s.runAction(C),a++,s=this.tiles[i(a)][r],n=!0}}else this.moveTilePosition(u,l,r,i(a),r),s=u,n=!0}return n},moveHorizontally:function(e,o,i){for(var n=!1,r=0;r<e;r++)for(var a=0,s=this.tiles[r][i(a)],c=1;c<o;c++){var l=i(c),u=this.tiles[r][l];if(null!=u)if(null!=s){var h=s.getComponent("Tile"),g=u.getComponent("Tile"),d=i(a+1);if(h.tag!=g.tag)l!=d?(this.moveTilePosition(u,r,l,r,d),a++,n=!0):a=c,s=u;else{var f=t("Manager"),m=Math.pow(f.cardinality,g.tag+1);this.addScore(m),this.moveTilePosition(u,r,l,s.row,s.col),this.tiles[s.row][s.col]=s;var v=cc.delayTime(this.animationDuration),p=cc.callFunc(this.updateTag,this,u),C=cc.sequence([v,p]);s.runAction(C),a++,s=this.tiles[r][i(a)],n=!0}}else this.moveTilePosition(u,r,l,r,i(a)),s=u,n=!0}return n},updateTag:function(t,e){var o=t.getComponent("Tile");o.tag+=1,o.updateTag(),e.removeFromParent()}}),cc._RF.pop()},{Manager:"Manager"}],Manager:[function(t,e){"use strict";cc._RF.push(e,"47c83nNWbBKHLx7R+Tiygke","Manager"),cc.Class({extends:cc.Component,statics:{cardinality:2,order:4,tileSize:{width:130,height:130},backgroundColor:function(){return cc.color(250,248,239,255)},scoreBoardColor:function(){return cc.color(187,173,160,255)},socreHintColor:function(){return cc.color(235,231,227,255)},socreLabelColor:function(){return cc.color(255,255,255,255)},buttonColor:function(){return cc.color(119,110,101,255)},colorForTag:function(t){var e=cc.color(255,255,255,255);switch(t){case 0:e=cc.color(238,228,218,255);break;case 1:e=cc.color(237,224,200,255);break;case 2:e=cc.color(242,177,121,255);break;case 3:e=cc.color(245,149,99,255);break;case 4:e=cc.color(246,124,95,255);break;case 5:e=cc.color(246,94,59,255);break;case 6:e=cc.color(237,207,114,255);break;case 7:e=cc.color(237,204,97,255);break;case 8:e=cc.color(237,200,80,255);break;case 9:e=cc.color(237,197,63,255);break;case 10:e=cc.color(237,194,46,255)}return e},textColorForTag:function(t){var e=cc.color(255,255,255,255);switch(t){case 0:case 1:e=cc.color(118,109,100,255)}return e},getRowCount:function(){return this.order},getColCount:function(){return this.order}}}),cc._RF.pop()},{}],ScoreBoardUI:[function(t,e){"use strict";cc._RF.push(e,"a6aab8B42NDdoA4LFpqn/fL","ScoreBoardUI"),cc.Class({extends:cc.Component,properties:{boardBackground:cc.Sprite,boardHint:cc.Label,boardLabel:cc.Label},onLoad:function(){var e=t("Manager");this.boardBackground.node.color=e.scoreBoardColor(),this.boardHint.node.color=e.socreHintColor(),this.boardLabel.node.color=e.socreLabelColor()}}),cc._RF.pop()},{Manager:"Manager"}],Setting:[function(t,e){"use strict";cc._RF.push(e,"a9457HC1rxKlKVj7VRGaaXh","Setting"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){}}),cc._RF.pop()},{}],Tile:[function(t,e){"use strict";cc._RF.push(e,"bb0c91TruNI4KugNQ8+Qfus","Tile"),cc.Class({extends:cc.Component,properties:{tag:0,row:0,col:0,label:{default:null,type:cc.Label}},onLoad:function(){this.label.fontSize=50,this.setTag(0)},update:function(){},setTag:function(t){this.tag=t,this.updateTag()},updateTag:function(){var e=t("Manager"),o=e.colorForTag(this.tag);this.node.color=o;var i=e.textColorForTag(this.tag);this.label.node.color=i;var n=Math.pow(e.cardinality,this.tag+1);this.label.string=n.toString(),cc.log("Update tag: "+this.tag)},save:function(){var t={};return t.row=this.row,t.col=this.col,t.tag=this.tag,cc.log("save tag: "+this.tag),t}}),cc._RF.pop()},{Manager:"Manager"}],"use_v2.0.x_cc.Toggle_event":[function(t,e){"use strict";cc._RF.push(e,"128db4/O0NOAplvrHpqibgh","use_v2.0.x_cc.Toggle_event"),cc.Toggle&&(cc.Toggle._triggerEventInScript_check=!0),cc._RF.pop()},{}]},{},["Game","Manager","ScoreBoardUI","Setting","Tile","use_v2.0.x_cc.Toggle_event"]);